# Active Context: Chrome AI Assist

## 現在の作業フォーカス

### システムプロンプト改善 & API統合修正 (完了)
- AIがページコンテンツを正確に理解し応答するための詳細なプロンプト実装
- ページ内容に基づいた正確な回答を提供するよう明確に指示
- 一般知識ではなくページコンテンツの参照を重視
- 回答時の参照箇所明示を要求
- **重要修正**: OpenAI/AnthropicのAPI呼び出しでシステムプロンプトが正常に送信されるよう修正
  - OpenAI: systemメッセージをmessages配列の最初に追加
  - Anthropic: systemパラメータとして送信
  - Bedrock: 既存実装のまま（system パラメータ使用）

### デバッグ情報表示機能 (完了)
- AI Chat画面にデバッグパネルを追加
- 現在のAIモデル、プロンプト、コンテキスト情報を表示
- API呼び出しの詳細情報とパフォーマンス測定
- デバッグ情報のコピー、エクスポート機能

### 現在のプロジェクト状態
- **基本機能**: 実装済み・動作可能
- **UI/UX**: 基本的なインターフェース完成
- **AI統合**: 3プロバイダー対応済み
- **セキュリティ**: 基本的な対策実装済み

## 最近の変更・発見

### コード構造の理解
1. **マルチプロバイダー対応**: AWS Bedrock、OpenAI、Anthropic Claude
2. **動的UI制御**: API設定状況に基づく機能有効化
3. **セキュリティ重視**: XSS防止、CSP対応、権限最小化
4. **ユーザビリティ**: キーボードショートカット、状態フィードバック

### 技術的パターン
- Manifest V3への完全対応
- Service Workerベースのバックグラウンド処理
- Content Scriptsによるページ統合
- Chrome Storage APIの活用

## 次のステップ・優先事項

### 短期 (1-2週間)
1. **機能テスト**: 既存機能の動作確認・デバッグ
2. **ドキュメント整備**: README更新、使用方法の明文化
3. **エラーハンドリング強化**: より詳細なエラー情報とユーザーガイダンス

### 中期 (1ヶ月)
1. **パフォーマンス最適化**: レスポンス時間の改善
2. **UI/UX改善**: より直感的なインターフェース
3. **機能拡張**: 新しいAI機能の追加

### 長期 (2-3ヶ月)
1. **TypeScript移行**: 型安全性の向上
2. **テスト自動化**: Jest等のテストフレームワーク導入
3. **CI/CD構築**: 自動デプロイパイプライン

## アクティブな決定事項

### 技術選択
- **Vanilla JavaScript**: フレームワークを使わずシンプルに保つ
- **Chrome Storage**: 状態管理にChrome APIを活用
- **マルチプロバイダー**: 特定のAIサービスに依存しない設計

### 設計方針
- **セキュリティファースト**: 最小権限の原則
- **ユーザーエクスペリエンス重視**: 直感的で高速な操作性
- **拡張性**: 将来的な機能追加を容易にする構造

## 学習・インサイト

### Chrome拡張機能開発
- Manifest V3の制約と最適化手法
- Service Workerの効果的な活用方法
- Content Scriptsとの安全な通信パターン

### AI統合のベストプラクティス
- 複数プロバイダーの統一インターフェース設計
- API率限制とエラーハンドリング
- ユーザーのプライバシー保護

### 重要な実装パターン
- 非同期処理の一貫した処理方法
- UIの動的な状態管理
- エラー情報のユーザーフレンドリーな表示

## プロジェクトの強み
1. **シンプルで安定した構造**: 過度に複雑にせず、実用性重視
2. **セキュリティ配慮**: Chrome拡張機能のベストプラクティス準拠  
3. **マルチプロバイダー対応**: 特定サービスへの依存リスク軽減
4. **ユーザビリティ**: キーボードショートカット等の利便性機能

## 現在の課題・注意点
1. **テストの不足**: 手動テストのみで自動テストなし
2. **エラーハンドリング**: より詳細なユーザーガイダンスが必要
3. **パフォーマンス**: 大きなページでの処理速度最適化余地あり
4. **ドキュメント**: ユーザー向け・開発者向け両方の整備が必要
